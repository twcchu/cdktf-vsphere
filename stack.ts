import { Construct } from "constructs";
import { TerraformStack, TerraformVariable } from "cdktf";

/*Provider bindings are generated by running cdktf get.
See https://cdk.tf/provider-generation for more details.*/
import * as vsphere from "./.gen/providers/vsphere";


export class MyStack extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);

    // define resources here

    /*Terraform Variables are not always the best fit for getting inputs in the context of Terraform CDK.
    You can read more about this at https://cdk.tf/variables*/
    // TODO get input from app
    const vspherePassword = new TerraformVariable(this, "vsphere_password", {
      description: "The password used to log into vSphere SSO",
      sensitive: true,
    });
    const vsphereUsername = new TerraformVariable(this, "vsphere_username", {
      description: "The username used to log into vSphere SSO",
    });

    new vsphere.VsphereProvider(this, "vsphere", {
      allowUnverifiedSsl: true,
      user: vsphereUsername.value,
      password: vspherePassword.value,
      vsphereServer: "vcenter.lab1.bwnet.us",
    });

    const datacenter = new vsphere.DataVsphereDatacenter(
      this,
      "datacenter",
      {
        name: "lab",
      }
    );

    const datastore = new vsphere.DataVsphereDatastore(this, "datastore", {
      name: "vsphere_lab2_vsidata_ds_1",
      datacenterId: datacenter.id,
    });

    const network = new vsphere.DataVsphereNetwork(this, "network", {
      datacenterId: datacenter.id,
      name: "LAB1-DC-APP7",
    });

    const resourcepool = new vsphere.DataVsphereResourcePool(this, "pool", {
      datacenterId: datacenter.id,
      name: "rp-team-systems_platform",
    });

    const template_vm = new vsphere.DataVsphereVirtualMachine(this, "template_vm", {
      name: "packer-centos-7",
      datacenterId: datacenter.id,
    })

    new vsphere.VirtualMachine(this, "vm", {
      datastoreId: datastore.id,
      disk: [
        {
          label: "disk0",
          size: 32,
        },
      ],
      guestId: template_vm.guestId,
      name: "hello",
      networkInterface: [
        {
          networkId: network.id,
        },
      ],
      resourcePoolId: resourcepool.id,
      clone: {
        templateUuid: template_vm.id,
      },
    });

    // new RemoteBackend(this, {
    //   hostname: "app.terraform.io",
    //   organization: "bw-systems",
    //   workspaces: {
    //     name: "cdktf-vsphere"
    //   },
    // });
  }
}

